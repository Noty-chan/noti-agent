# AGENTS.md — рабочие правила для проекта Noti

> Основной источник требований: `noty_specification.md`.
> Любые архитектурные, поведенческие и продуктовые решения должны сверяться со спецификацией.

## Язык ответов
- Все ответы ассистента пользователю должны быть **только на русском языке**.

## Обязательный фокус проекта
Ноти — это AI-персона с характером, памятью, фильтрацией и управлением чатом.
В реализации обязательно учитывать все системные блоки из спецификации:
1. Ingestion/Routing сообщений.
2. Interest Filter (эвристика + embeddings + рандомизация).
3. Dynamic Context Builder.
4. Prompt Construction (модульные слои + версии personality).
5. Response Processing (tool-calls, память, настроение).
6. Отправка ответа и полное логирование.

## Правила архитектуры
- Следовать целевой структуре каталогов `noty/` (core, memory, filters, prompts, tools, mood, thought, data, utils, config).
- Один модуль = одна доменная ответственность.
- Критичные действия — только через проверки ролей и/или подтверждение.
- Нельзя смешивать инфраструктурный код, бизнес-логику и конфиги в одном файле.

## Правила памяти
- Кратковременное состояние: in-memory/redis-подобная модель.
- Оперативные данные: SQLite (структуры по спецификации).
- Долговременная семантическая память: Mem0 + Qdrant.
- Архив: `.jsonl` логи по дням.

## Правила поведения Ноти
- Характер: сарказм/язвительность в рамках безопасности.
- Адаптация к пользователю через relationship score.
- Селективные ответы: целевой respond-rate около 20%.
- Внутренний монолог хранится только во внутренних логах.

## Разработка и изменения
- Любые эволюционные изменения personality должны иметь версию и причину изменения.
- Перед реализацией сверять с `TASK_MAP.md` и отмечать прогресс.
- При отклонении от спецификации документировать компромисс и причину.

## Язык ответов
- Все ответы ассистента пользователю должны быть **только на русском языке**.

## Назначение проекта
- Проект строит AI-персону «Ноти»: язвительный ассистент с памятью, фильтрацией сообщений, динамическим контекстом, системой настроения, инструментами модерации и внутренним монологом.

## Основные подсистемы (по `noty_specification.md`)
1. Ingestion/Routing входящих сообщений (VK/TG).
2. Фильтрация интересности сообщений (эвристика + эмбеддинги + рандомизация).
3. Динамический контекст (recent + semantic + important).
4. Сборка промпта из модульных слоёв.
5. Генерация ответа и безопасное выполнение tool calls.
6. Обновление памяти, отношений и настроения.
7. Логирование (включая внутренний монолог).

## Практические правила разработки
- Предпочитать модульную структуру: один доменный файл/модуль на одну подсистему.
- Критичные действия выполнять через подтверждение и проверку ролей.
- Для памяти разделять уровни: кратковременная, SQLite-оперативная, семантическая (Mem0), архив `.jsonl`.
- При изменениях поведения Ноти фиксировать причину в истории версий промпта.
- Любые изменения сверять с дорожной картой (`TASK_MAP.md`).

